import AccessibleToolbar from"./accessibleToolbar.js";const Quill=window.Quill;Quill.register("modules/toolbar",AccessibleToolbar,!0);const videoMessages=document.getElementById("videoMessages").dataset;export function initQuillEditors(e){const{description:t,instructions:n,tips:o}=e;let i=null,l=null;const r={container:[[{header:[2,3,4,!1]}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],["bold","italic","underline","strike"],[{align:[]}],[{list:"ordered"},{list:"bullet"}],["link","image","video"],["clean"]],handlers:{image:function(){const e=document.createElement("input");e.type="file",e.accept=".webp,.svg",e.click(),e.onchange=()=>{const t=e.files[0];if(!t)return;const n=new FileReader;n.onload=e=>{const t=this.quill.getSelection();this.quill.insertEmbed(t.index,"image",e.target.result,"user")},n.readAsDataURL(t)}},video:function(){i=this.quill,l=i.getSelection(!0),toggleModal("videoModal","open")},link:function(){i=this.quill,l=i.getSelection(!0),l&&0!==l.length?toggleModal("linkModal","open"):alert(videoMessages.noText)}}};function s(e,t,n){const o=new Quill(e,{theme:"snow",placeholder:n,modules:{toolbar:r},formats:["header","size","color","bold","italic","underline","strike","align","list","link","image","video","background"]});return t?.value&&"None"!==t.value&&(o.root.innerHTML=t.value),o}document.getElementById("videoConfirmBtn")?.addEventListener("click",()=>{const e=document.getElementById("videoUrlInput").value.trim(),t=document.getElementById("videoFileInput").files[0],n=i.getSelection(!0);if(n&&i){if(e){if(!function(e){return/^(https?:\/\/)?([\w\-]+\.)+[\w\-]+(\/[\w\-.,@?^=%&:/~+#]*)?$/.test(e)}(e))return void alert(videoMessages.urlInvalid);const t=function(e){try{const t=e.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^\s&]+)/);if(t)return`https://www.youtube.com/embed/${t[1]}`;const n=e.match(/vimeo\.com\/(\d+)/);return n?`https://player.vimeo.com/video/${n[1]}`:e}catch{return e}}(e);i.insertEmbed(n.index,"video",t,"user"),i.setSelection(n.index+1)}else{if(!t)return void alert(videoMessages.emptyInput);{const e=new FileReader;e.onload=e=>{i.insertEmbed(n.index,"video",e.target.result,"user"),i.setSelection(n.index+1)},e.readAsDataURL(t)}}toggleModal("videoModal","close")}}),document.getElementById("linkForm")?.addEventListener("submit",e=>{e.preventDefault();const t=document.getElementById("linkUrl").value.trim();l&&i&&(""===t?i.format("link",!1):i.format("link",t),toggleModal("linkModal","close"))});const c=s(document.getElementById("quill-description"),document.querySelector('textarea[name="description"]'),t),d=s(document.getElementById("quill-instructions"),document.querySelector('textarea[name="instructions"]'),n),a=s(document.getElementById("quill-tips"),document.querySelector('textarea[name="tips"]'),o);return document.querySelectorAll(".ql-tooltip a").forEach(e=>e.remove()),{quillDescription:c,quillInstructions:d,quillTips:a,descField:document.querySelector('textarea[name="description"]'),instrField:document.querySelector('textarea[name="instructions"]'),tipsField:document.querySelector('textarea[name="tips"]')}}