{% load i18n %}
{% load static %}

<header>
    <div class="menu-container">
        {% if request.user.is_authenticated %}
            <div class="profile-header">
                <img src="{{ request.user.get_avatar_url }}" alt="{{ request.user.username }} avatar" width="60" height="60" />
                <p class="dashboard-username">{{ request.user.username }}</p>
            </div>
        {% endif %}

        <div class="menu-bg"></div>
        <div class="menu-trigger" id="menuTrigger">
            <img
                src="{% static 'img/plate-black.svg' %}"
                alt="Menu"
                class="menu-plate"            
            />
            <a href="{% url 'home' %}">
                <span class="logo-text">
                    GOO:D
                    <span class="tooltip">God! Good! Go! :D</span>
                </span>
            </a>
        </div>
        
        <nav class="menu-links" id="menuLinks">    
            <div class="menu-bg"></div>
            <ul class="menu-list">
                <li>
                    <a class="nav-link spoon2" href="{% url 'home' %}">{% trans "Inicio" %}</a>
                </li>
                <li>
                    <a class="nav-link fork" href="{% url 'recipes:recipe_list' %}">{% trans "Recetas" %}</a>
                </li>
                <li>
                    <a class="nav-link knife" href="{% url 'contact' %}">{% trans "Contacto" %}</a>
                </li>
                <li>
                    <a class="nav-link spatula2" href="{% url 'search' %}">{% trans "Buscar" %}</a> 
                </li>
                {% if user.is_authenticated %}
                    <li>
                    <a class="nav-link roller" href="{% url 'accounts:profile' %}">{% trans "Mi perfil" %}</a>
                    </li>
                    <li >
                        <a class="nav-link spatula" href="{% url 'accounts:logout' %}">{% trans "Cerrar sesi√≥n" %}</a>
                    </li>
                {% else %}
                    <li>
                    <a class="nav-link knife-big" href="{% url 'accounts:login' %}">{% trans "Login" %}</a>
                    </li>
                    <li>
                    <a class="nav-link spatula" href="{% url 'accounts:register' %}">{% trans "Registro" %}</a>
                    </li>
                {% endif %}
            </ul>    
        </nav>
    </div>

    <div class="language-switcher">
        <div class="salt-button" id="toggle-language" role="button" tabindex="0">
            <img src="{% static 'img/condiment.svg' %}" alt="Language menu">
        
            <span class="lang-label">
              {{ LANGUAGE_CODE|upper }}
            </span>
          </div>

        <form method="post" class="languages" id="language-form" action="{% url 'set_language' %}">
            {% csrf_token %}
            <div >
                <select name="language" class="form-select select-lang" aria-label="{% trans 'Selecciona idioma' %}">
                {% get_current_language as LANGUAGE_CODE %}
                {% for lang_code, lang_name in LANGUAGES %}
                    <option value="{{ lang_code }}" {% if LANGUAGE_CODE == lang_code %}selected{% endif %}>
                        {{ lang_name }} ({{ lang_code }})
                    </option>
                {% endfor %}
                </select>
            </div>
            <input type="hidden" name="next" value="{{ request.path }}" />
            <input class="btn btn__lang" type="submit" value="{% trans 'Cambiar' %}">
        </form>
    </div>
</header>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const logoutLink = document.querySelector('a[href="{% url "accounts:logout" %}"]');
        if (logoutLink) {
            logoutLink.addEventListener('click', function (e) {
                e.preventDefault();
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = logoutLink.href;
    
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
                if (csrfToken) {
                    const tokenInput = document.createElement('input');
                    tokenInput.type = 'hidden';
                    tokenInput.name = 'csrfmiddlewaretoken';
                    tokenInput.value = csrfToken.value;
                    form.appendChild(tokenInput);
                }
    
                document.body.appendChild(form);
                form.submit();
            });
        }
    });
</script>
    